{% load static %}
{% load custom_filters %}

<!DOCTYPE html>
<html>
	<head>
		<title>Chat</title>
		{% comment %} <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.js"></script> {% endcomment %}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://jqueryvalidation.org/files/demo/site-demos.css">
        <link rel="stylesheet" href="../media/css/style.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
       
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
        <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>

        <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
        <!--- OWL CAROUSEL-->
        {% comment %} <link rel="stylesheet" href="media/assets/css/docs.theme.min.css"> {% endcomment %}
        <link rel="stylesheet" href="media/owlcarousel/assets/owl.carousel.min.css">
        <link rel="stylesheet" href="media/owlcarousel/assets/owl.theme.default.min.css">
        <script src="media/owlcarousel/owl.carousel.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		
        <link rel="stylesheet" href="{% static 'css/messages.css' %}">

    </head>
	<body>

        <header class="mariyo_pro_header pt-2 pb-2">
            <div class="container">
              <div class="row">
                <div class="col-md-3">
                  <img src="../media/img/Logo.png" class="img-fluid">
                </div>
                <div class="col-md-9 text-end">
                  <ul class="mt-2">
                    <li>
                      <a href="#"><i class="bi bi-heart"></i></a>
                    </li>
                    <li>
                      <a href="#"><i class="bi bi-bell"></i></a>
                    </li>
                    <li>
                      <a href="#">
                        <img src="../{{profil_image}}">
                       
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
        
          </header>
        


          <section class="shadow">
            <nav class="navbar navbar-expand-sm bg-white navbar-dark">
                <div class="container">
                
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="collapsibleNavbar">
                    <ul class="navbar-nav">
                      <li class="nav-item me-1">
                        <a class="nav-link text-black ps-3 pe-3" href="/profile_page">Profile</a>
                      </li>
                      <li class="nav-item me-1">
                        <a class="nav-link text-black ps-3 pe-3" href="/matching_list">Matching List</a>
                      </li>
                      <li class="nav-item me-1">
                        <a class="nav-link text-black ps-3 pe-3" href="/request_received">Requested Lists</a>
                      </li>
                      <li class="nav-item me-1">
                        <a class="nav-link text-black ps-3 pe-3" href="#">Saved Search</a>
                      </li>
                      <li class="nav-item me-1">
                        <a class="nav-link text-black ps-3 pe-3" href="#">Happy Couples</a>
                      </li>
                      <li class="nav-item me-1">
                        <a class="nav-link text-black ps-3 pe-3" href="#">Settings</a>
                      </li>
                      <li class="nav-item me-1">
                        <a class="nav-link text-black ps-3 pe-3 active" href="chat">Chat</a>
                      </li>
                      <!-- <li class="nav-item text-end float-right">
                        <a class="nav-link text-black" href="#">Chat</a>
                      </li> -->
                    </ul>
                    <div class="text-end w-30 pt-3 ms-auto" style="width:30%">
                        <p class="float-left">Profile Completeness</p>
                        <div class="progress mt-1 ms-2 float-left" style="width:50%">
                            <div class="progress-bar bg-success" style="width:80%"></div>
                        </div>
                        <p>80%</p>
                    </div>
                  </div>
                </div>
              </nav>
        </section>
        
        {% comment %} <script>
          currentUrl = window.location.href;
          parts = currentUrl.split("/");
          lastIndex = parts.length - 1;
          if(parts[lastIndex] == "profile_page"){
            $("section.shadow nav ul li:nth-child(1) a").addClass("active");
          }
          else if(parts[lastIndex] == "matching_list"){
            $("section.shadow nav ul li:nth-child(2) a").addClass("active");
          }
          else if(parts[lastIndex] == "request_received"){
            $("section.shadow nav ul li:nth-child(3) a").addClass("active");
          }
        </script> {% endcomment %}
    {% comment %} {% if user.is_authenticated %} {% endcomment %}
        <input type="hidden" id="logged-in-user" value="{{ pfdata_id }}">
    {% comment %} {% endif %} {% endcomment %}
		<div class="container h-100 bg-gray">
			<div class="row h-100 ">
				<div class="col-md-4 col-xl-3 chat h-100 mt-4">
                    <div class="card mb-sm-3 mb-md-0 contacts_card">
					{% comment %} <div class="card-header">
						<div class="input-group">
							<input type="text" placeholder="Search..." name="" class="form-control search">
							<div class="input-group-prepend">
								<span class="input-group-text search_btn"><i class="fas fa-search"></i></span>
							</div>
						</div>
					</div> {% endcomment %}
					<div class="card-body contacts_body">
						<ui class="contacts">
                            {% for name,pfdatasarrimage,id in datas%}  
                                {% comment %} {% if forloop.first %}active{% endif %} {% endcomment %}
                                <li class="contact-li" chat-id="chat_{{ id }}" style="cursor: pointer">
                                    <div class="d-flex bd-highlight">
                                        <div class="img_cont">
                                            <img src="../{{ pfdatasarrimage }}" class="rounded-circle user_img">
                                            {% comment %} <span class="online_icon"></span> {% endcomment %}
                                        </div>
                                        <div class="user_info">
                                            <span>{{ name }}</span>
                                            {% comment %} {% if thread.first_person == user %}
                                                <span>{{ thread.second_person.username }}</span>
                                            {% else %}
                                                <span>{{ thread.first_person.username }}</span>
                                            {% endif %} {% endcomment %}

{#                                            <p>Kalid is online</p>#}
                                        </div>
                                    </div>
                                </li>
                                
                            {% endfor %}
						</ui>
					</div>
					<div class="card-footer"></div>
				</div></div>
				<div class="col-md-8 col-xl-9 chat h-100 mt-4">
                    {% comment %} {% for name1 in datas%} 
                        {{name1}}
                    {% endfor %} {% endcomment %}
                    {% comment %} {% for name,pfdatasarrimage,id in da%}  
                      <p class="keep">{{ name }}</p>
                    {% endfor %} {% endcomment %}
					<div class="card">
                       
                        {% comment %} {% for thread in Threads %} {% endcomment %}
                        {% for name,pfdatasarrimage,id,toid in da%}  
                            <div class="messages-wrapper  {% if forloop.first %}hide is_active{% else %}hide{% endif %}" chat-id="chat_{{ id }}" other-user-id="{{ toid }}">
                                <div class="card-header msg_head">
                                    <div class="d-flex bd-highlight">
                                        <div class="img_cont">
                                            <img src="../{{pfdatasarrimage}}" class="rounded-circle user_img">
                                            {% comment %} <span class="online_icon"></span> {% endcomment %}
                                        </div>
                                        <div class="user_info">
                                            <span>Chat with {{ name }}</span>
                                            {% comment %} {% if thread.first_person == user %}
                                                    <span>Chat with {{ thread.second_person.username }}</span>
                                            {% else %}
                                                <span>Chat with {{ name }}</span>
                                            {% endif %} {% endcomment %}

                                            <p>{{ thread.chatmessage_thread.all.count }} messages</p>
                                        </div>
                                    
                                    </div>
                                    {% comment %} <span id="action_menu_btn"><i class="fas fa-ellipsis-v"></i></span> {% endcomment %}
                                
                                </div>

                                <div class="card-body msg_card_body">
                                    
                                    {% for chat in message %}
                                        {% for c in chat %}
                                            {% comment %} {{ c.thread_id }} {% endcomment %}
                                            {% if c.thread_id == id %}
                                            {% comment %} {{ c.user|cut:"profile_finder object ("|cut:")"|to_int }} {% endcomment %}
                                            
                                                {% if c.user|cut:"profile_finder object ("|cut:")"|to_int == pfdata_id %}
                                                    <div class="d-flex mb-4 replied">
                                                        <div class="msg_cotainer_send">
                                                            {{ c.message }}
                                                            <span class="msg_time_send">{{ chat.timestamp|date:"d D" }}, {{ chat.timestamp|time:"H:i" }}</span>
                                                        </div>
                                                        <div class="img_cont_msg">
                                                            <img src="../{{profil_image}}" class="rounded-circle user_img_msg">
                                                        </div>
                                                    </div>
                                                {% else %}
                                                    <div class="d-flex mb-4 received">
                                                        <div class="img_cont_msg">
                                                            <img src="../{{pfdatasarrimage}}" class="rounded-circle user_img_msg">
                                                        </div>
                                                        <div class="msg_cotainer">
                                                            {{ c.message }}
                                                            <span class="msg_time">{{ chat.timestamp|date:"d D" }}, {{ chat.timestamp|time:"H:i" }}</span>
                                                        </div>
                                                    </div>
                                                {% endif %} 
                                            {% endif %}
                                        {% endfor %}
                                            
                                    {% endfor %}
                                        {% comment %} {% if chat.user == pfdata_id %}
                                            
                                        
                                        {% endif %} {% endcomment %}
                                    {% comment %} {% endfor %} {% endcomment %}

                                </div>

                            </div>
                                    {% endfor %}
                        <div class="card-footer">
                                <form id="send-message-form">
                                    <div class="input-group">
                                        {% comment %} <div class="input-group-append">
                                            <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
                                        </div> {% endcomment %}
                                        <input type="text" name="" id="input-message" class="form-control type_msg" placeholder="Type your message...">
                                        <div class="input-group-append">
                                            <button class="btn btn-secondary pt-3 pb-3" type="submit">
                                                <span class="input-group-text send_btn">
                                                    <i class="fas fa-location-arrow"></i>
                                                </span>
                                            </button>

                                        </div>
                                </div>
                                </form>
                            </div>
                    </div>
				</div>
			</div>
		</div>

        
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-4">
                                <img src="../media/img/Logo.png" class="img-fluid">
                            </div>
                        </div>
                        
                        <p class="keep text-white w-68 line-height-25 mt-4">Marriyo is One Of The Prominent Matrimonial Sites in India. We Understand The Importance 
                            Of Marriage In Our Indian Society And Hence Blend Technology With Tradition Efficiency For A
                            Secure Matchmaking Experience To All Our Members.
                        </p>
                        <ul class="nav mt-5 footer-icon mb-4">
                            <li class="nav-item me-3">
                              <a class="nav-link1 text-white" href="#"><i class="bi bi-facebook"></i></a>
                            </li>
                            <li class="nav-item me-3">
                              <a class="nav-link1 text-white" href="#"><i class="bi bi-twitter"></i></a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link1 text-white" href="#"><i class="bi bi-linkedin"></i></a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6 text-end">
                        <h5 class="text-white ">Quick Links</h5>
                        <ul class="footer_links">
                            <li class="line-height-25"><a href="#" class="text-white ">Home</a></li>
                            <li class="line-height-25"><a href="#" class="text-white">About Us</a></li>
                            <li class="line-height-25"><a href="#" class="text-white">Login</a></li>
                            <li class="line-height-25"><a href="#" class="text-white">Register</a></li>
                            <li class="line-height-25"><a href="#" class="text-white">Sitemap</a></li>
                            <li class="line-height-25"><a href="#" class="text-white">Contact Us</a></li>
                            <li class="line-height-25"><a href="#" class="text-white">Blog</a></li>
                            <li class="line-height-25"><a href="#" class="text-white">Support</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <hr>
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <p class="keep text-white keep_text">© <span id="year"></span> Marriyo. All Rights Reserved.</p>
                    </div>
                    <div class="col-md-6">
                        <ul class="footer_links nav footer-links-terms float-right">
                            <li class="line-height-25"><a href="#" class="text-white ">Terms And Conditions</a></li>
                            <li class="line-height-25"><a href="#" class="text-white">Privacy Policy</a></li>
                            
                        </ul>
                    </div>
                </div>
            </div>
        </footer>
        <script>
            var dateobj = new Date();
            // Year from the above object 
            // is being fetched using getFullYear() 
            var dateObject = dateobj.getFullYear();
            document.getElementById("year").innerHTML=dateObject;

            {% comment %} $(".contact-li").click(function(){
                $(this).addClass("active");
            }); {% endcomment %}
        </script>

        <script src="{% static 'js/messages.js' %}"></script>

	</body>
</html>
